doctype html
html(ng-app='app')
  head
    meta(charset='utf-8')
    base(href='/')
    meta(name='viewport', content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no')
    meta(name='mobile-web-app-capable', content='yes')
    meta(name='apple-mobile-web-app-capable', content='yes')
    meta(name='apple-mobile-web-app-title', content='STF')
    meta(name='format-detection', content='telephone=no')
    meta(name='apple-mobile-web-app-status-bar-style', content='black-translucent')
    link(href='static/logo/exports/STF-128.png', rel='apple-touch-icon')

    title(ng-bind='pageTitle ? "STF - " + pageTitle : "STF"') STF
  body(ng-cloak).bg-1.fill-height.unselectable
    div(ng-controller='LayoutCtrl', basic-mode, admin-mode, standalone, landscape).fill-height
      .pane-top.fill-height(fa-pane)
        .pane-top-bar(fa-pane, pane-id='menu', pane-anchor='north',
          pane-size='{{!$root.basicMode && !$root.standalone ? 44 : 0 }}px',
          pane-handle='')

          div(ng-include='"menu.pug"')

        .pane-center(fa-pane, pane-id='main', pane-anchor='center').fill-height
          socket-state
          div(growl)
          div(ng-view).fill-height

    script(src='/app/api/stf/state.js')
    script(src='static/app/build/entry/commons.entry.js')
    script(src='static/app/build/entry/app.entry.js')
    
    script(src='https://ajax.googleapis.com/ajax/libs/jquery/3.0.0/jquery.min.js')
    script.
      $(window).on('mouseover', (function () {
        window.onbeforeunload = null;
      }));
      $(window).on('mouseout', (function () {
        window.onbeforeunload = ConfirmLeave;
      }));
     function ConfirmLeave() {
        $('#releaseBtn').trigger("click");
     }
     var prevKey="";
     $(document).keydown(function (e) {
        if (e.key=="F5") {
          window.onbeforeunload = null;
        }
        else if (e.key.toUpperCase() == "W" && prevKey == "CONTROL") {
          window.onbeforeunload = ConfirmLeave;
        }
        else if (e.key.toUpperCase() == "R" && prevKey == "CONTROL") {
          window.onbeforeunload = ConfirmLeave;
        }
        else if (e.key.toUpperCase() == "F4" && (prevKey == "ALT" || prevKey == "CONTROL")) {
          window.onbeforeunload = ConfirmLeave;
        }
        prevKey = e.key.toUpperCase();
     });

